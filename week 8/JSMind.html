<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const mindarThree = new window.MINDAR.IMAGE.MindARThree({
      container: document.body,
      imageTargetSrc: "./targets.mind",
      maxTrack: 1,
    });

    const { renderer, scene, camera } = mindarThree;
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;

    const anchor = mindarThree.addAnchor(0);
    const group = new THREE.Group();
    anchor.group.add(group);

    // Світло
    scene.add(new THREE.AmbientLight(0xffffff, 0.6));
    const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
    dirLight.position.set(1, 3, 2);
    dirLight.castShadow = true;
    scene.add(dirLight);

    const loader = new THREE.TextureLoader();
    const brickBump = loader.load('./brick_bump.jpg');
    const brickDiffuse = loader.load('./brick_diffuse.jpg');
    const brickRoughness = loader.load('./brick_roughness.jpg');

    // Створення пірамід
    const pyramids = [];

    function createPyramid(scale, position, texture, goldScale = 1) {
      const pyramidGroup = new THREE.Group();
      pyramidGroup.position.set(...position);
      pyramidGroup.scale.set(scale, scale, scale);

      const baseCone = new THREE.Mesh(
        new THREE.ConeGeometry(1, 1, 4),
        new THREE.MeshStandardMaterial({ map: texture, roughness: 0.7, metalness: 0.1 })
      );
      baseCone.position.y = 0.5;
      baseCone.rotation.y = Math.PI / 4;
      baseCone.castShadow = true;
      baseCone.receiveShadow = true;
      pyramidGroup.add(baseCone);

      const topCone = new THREE.Mesh(
        new THREE.ConeGeometry(0.12 * goldScale, 0.08 * goldScale, 4),
        new THREE.MeshStandardMaterial({ color: 0xFFD700, metalness: 0.8, roughness: 0.2 })
      );
      topCone.position.y = 1.0;
      topCone.rotation.y = Math.PI / 4;
      topCone.castShadow = true;
      topCone.receiveShadow = true;
      pyramidGroup.add(topCone);

      group.add(pyramidGroup);
      pyramids.push(pyramidGroup); // зберігаємо для анімації
    }

    createPyramid(0.65, [-0.5, 0, -0.5], brickBump);
    createPyramid(0.59, [0, 0, 0], brickDiffuse);
    createPyramid(0.28, [0.5, 0, 0.5], brickRoughness, 0.5);

    await mindarThree.start();

    // Анімація обертання
    renderer.setAnimationLoop(() => {
      pyramids.forEach(pyramid => {
        pyramid.rotation.y += 0.01;
      });
      renderer.render(scene, camera);
    });
  });
</script>

