<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>MindAR: –î–≤–∞ –º–∞—Ä–∫–µ—Ä–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-three.prod.js"></script>
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.150.1/build/three.module.js",
        "GLTFLoader": "https://unpkg.com/three@0.150.1/examples/jsm/loaders/GLTFLoader.js"
      }
    }
  </script>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    #status {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px;
      border-radius: 5px;
      font-family: sans-serif;
      font-size: 14px;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div id="status">–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...</div>

  <script type="module">
    import * as THREE from "three";
    import { GLTFLoader } from "GLTFLoader";

    const statusEl = document.getElementById("status");

    const { MindARThree } = window.MINDAR.IMAGE;
    const mindarThree = new MindARThree({
      container: document.body,
      imageTargetSrc: "./marker.mind", // –ì–æ–ª–æ–≤–Ω–∏–π marker
      maxTrack: 2, // –î–æ–∑–≤–æ–ª–∏—Ç–∏ –¥–≤–∞ –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –º–∞—Ä–∫–µ—Ä–∏
    });

    const { renderer, scene, camera } = mindarThree;

    // –°–≤—ñ—Ç–ª–æ
    scene.add(new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1));

    // ===== –ú–ê–†–ö–ï–† 1 ‚Äî 3D –ú–û–î–ï–õ–¨ =====
    const anchor1 = mindarThree.addAnchor(0); // marker.mind
    const loader = new GLTFLoader();
    loader.load(
      "https://raw.githubusercontent.com/hiukim/mind-ar-js/master/examples/image-tracking/assets/band-example/raccoon/scene.gltf",
      (gltf) => {
        gltf.scene.scale.set(0.1, 0.1, 0.1);
        gltf.scene.position.set(0, -0.4, 0);
        anchor1.group.add(gltf.scene);
      }
    );

    anchor1.onTargetFound = () => {
      statusEl.textContent = "‚úÖ –ú–∞—Ä–∫–µ—Ä 1 (3D –º–æ–¥–µ–ª—å) –∑–Ω–∞–π–¥–µ–Ω–æ";
    };
    anchor1.onTargetLost = () => {
      statusEl.textContent = "üîç –ú–∞—Ä–∫–µ—Ä 1 –≤—Ç—Ä–∞—á–µ–Ω–æ";
    };

    // ===== –ú–ê–†–ö–ï–† 2 ‚Äî –í–Ü–î–ï–û =====
    const anchor2 = mindarThree.addAnchor(1); // marker2.mind

    const video = document.createElement("video");
    video.src = "./video.mp4"; // –∞–±–æ –∞–±—Å–æ–ª—é—Ç–Ω–∏–π —à–ª—è—Ö
    video.crossOrigin = "anonymous";
    video.loop = true;
    video.muted = true;
    video.playsInline = true;
    video.preload = "auto";

    const videoTexture = new THREE.VideoTexture(video);
    const videoMaterial = new THREE.MeshBasicMaterial({ map: videoTexture });
    const plane = new THREE.Mesh(new THREE.PlaneGeometry(1, 0.6), videoMaterial);
    plane.position.set(0, 0, 0);
    anchor2.group.add(plane);

    anchor2.onTargetFound = () => {
      statusEl.textContent = "‚úÖ –ú–∞—Ä–∫–µ—Ä 2 (–≤—ñ–¥–µ–æ) –∑–Ω–∞–π–¥–µ–Ω–æ";
      video.play();
    };
    anchor2.onTargetLost = () => {
      statusEl.textContent = "üîç –ú–∞—Ä–∫–µ—Ä 2 –≤—Ç—Ä–∞—á–µ–Ω–æ";
      video.pause();
    };

    // ======= –°–¢–ê–†–¢ =======
    const start = async () => {
      await mindarThree.start();
      renderer.setAnimationLoop(() => {
        renderer.render(scene, camera);
      });
      statusEl.textContent = "üîç –ù–∞–≤–µ–¥—ñ—Ç—å –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä–∏";
    };

    start();
  </script>
</body>
</html>
